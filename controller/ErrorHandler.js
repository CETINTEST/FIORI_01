/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox"],function(O,M){"use strict";return O.extend("ui.s2p.mm.requisition.maintain.s1.controller.ErrorHandler",{constructor:function(c){this._oResourceBundle=c.getModel("i18n").getResourceBundle();this._oComponent=c;this._oModel=c.getModel();this._bMessageOpen=false;this._sErrorText=this._oResourceBundle.getText("errorText");this._oModel.attachMetadataFailed(function(e){var p=e.getParameters();this._showMetadataError(p.response);},this);this._oModel.attachRequestFailed(function(E){var p=E.getParameters();if(p.response.statusCode!=="404"||(p.response.statusCode===404&&p.response.responseText.indexOf("Cannot POST")===0)){var m=p.response.statusText;try{if(JSON.parse(p.response.responseText).error&&JSON.parse(p.response.responseText).error.message){var a=JSON.parse(p.response.responseText).error.code;m=JSON.parse(p.response.responseText).error.message.value;}else{m=m+": "+p.response.responseText.substring(p.response.responseText.search("1>")+2,p.response.responseText.search("</h1"));}}catch(e){m=this._oResourceBundle.getText("errorText")+" : "+m;}if(a!=="005056A509B11EE1B9A8FEC11C23378E"){this._showServiceError(m);}else{sap.ui.getCore().getMessageManager().removeAllMessages();}}},this);},_showMetadataError:function(d){M.error(this._sErrorText,{id:"metadataErrorMessageBox",details:d,styleClass:this._oComponent.getContentDensityClass(),actions:[M.Action.RETRY,M.Action.CLOSE],onClose:function(a){if(a===M.Action.RETRY){this._oModel.refreshMetadata();}}.bind(this)});},_showServiceError:function(d){if(this._bMessageOpen){return;}this._bMessageOpen=true;M.error(d,{id:"serviceErrorMessageBox",styleClass:this._oComponent.getContentDensityClass(),actions:[M.Action.CLOSE],onClose:function(){this._bMessageOpen=false;}.bind(this)});}});});
